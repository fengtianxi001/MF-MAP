var L=Object.defineProperty;var v=(r,t,o)=>t in r?L(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o;var a=(r,t,o)=>(v(r,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();const c=6378137,M=2*Math.PI*c,I=256,l=new Array(18).fill(0).map((r,t)=>M/Math.pow(2,t)/I);class h{static lngLat2Mercator(t,o){const i=t*Math.PI*c/180,e=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180)*Math.PI*c/180;return[i,e]}static mercatorToLngLat(t,o){const i=t/c/Math.PI*180,e=180/Math.PI*(2*Math.atan(Math.exp(o/c/Math.PI*180*Math.PI/180))-Math.PI/2);return[i,e]}static getPxFromLngLat(t,o,i){let[e,n]=h.lngLat2Mercator(t,o);e+=M/2,n=M/2-n;const s=Math.floor(e/l[i]),m=Math.floor(n/l[i]);return[s,m]}}class P{constructor(){a(this,"center");a(this,"zoom");a(this,"app");a(this,"ctx");a(this,"canvas");a(this,"isMousedown");this.center=[120,30],this.zoom=17,this.isMousedown=!1,this.app=document.querySelector("#app"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.initCaontainer(),this.addListener(),this.render()}initCaontainer(){const{clientWidth:t,clientHeight:o}=this.app;this.canvas.width=t,this.canvas.height=o,this.ctx.translate(t/2,o/2),this.app.appendChild(this.canvas)}render(){this.ctx.clearRect(0,0,this.app.clientWidth,this.app.clientHeight);const t=h.lngLat2Mercator(...this.center),o=Math.floor((t[0]+Math.PI*c)/(l[this.zoom]*256)),i=Math.floor((Math.PI*c-t[1])/(l[this.zoom]*256)),e=[o*256,i*256],n=h.getPxFromLngLat(...this.center,this.zoom),s=[n[0]-e[0],n[1]-e[1]];let m=Math.ceil((this.app.clientWidth/2-s[0])/256),f=Math.ceil((this.app.clientHeight/2-s[1])/256),g=Math.ceil((this.app.clientWidth/2-(256-s[0]))/256),w=Math.ceil((this.app.clientHeight/2-(256-s[1]))/256);for(let d=-m;d<=g;d++)for(let u=-f;u<=w;u++){let p=new Image;p.src=`https://wprd01.is.autonavi.com/appmaptile?style=7&x=${o+d}&y=${i+u}&z=${this.zoom}`,p.onload=()=>{this.ctx.drawImage(p,d*256-s[0],u*256-s[1])}}}addListener(){this.app.addEventListener("mousedown",this.onMousedown.bind(this)),window.addEventListener("mouseup",this.onMouseup.bind(this)),window.addEventListener("mousemove",this.onMousemove.bind(this)),window.addEventListener("wheel",this.onMousewheel.bind(this))}onMousedown(t){t.which===1&&(this.isMousedown=!0)}onMouseup(){this.isMousedown=!1}onMousemove(t){if(!this.isMousedown)return;const o=l[this.zoom],i=t.movementX*o,e=t.movementY*o,[n,s]=h.lngLat2Mercator(...this.center);this.center=h.mercatorToLngLat(n-i,s+e),this.render()}onMousewheel(t){t.deltaY<0?this.zoom++:t.deltaY>0&&this.zoom--,this.render()}}new P;
